{"version":3,"sources":["images/favicon.png","layout/Login.jsx"],"names":["Login","useState","email","setEmail","emailInvalid","setEmailInvalid","code","setCode","codeInvalid","setCodeInvalid","success","setSuccess","validity","setValidity","valid","setValid","right","setRight","setError","btnloading","setBtnloading","loadBtn","setLoadBtn","open","message","type","alertState","setAlertState","otpApi","a","form","axios","post","process","res","data","console","log","response","status_code","errors","errArr","Object","keys","length","error","forEach","key","loginApi","password","localStorage","setItem","access_token","refresh_token","sessionStorage","JSON","stringify","useEffect","getItem","tokenData","token","headers","Authorization","slice","get","then","info","first_name","last_name","role","window","location","href","catch","err","warn","otpClick","handleSubmit","e","preventDefault","handleAlertClose","timer","setTimeout","setTimer","clearTimeout","React","counter","setCounter","setInterval","clearInterval","NewHeader","className","src","account","alt","action","onSubmit","value","name","onChange","target","pattern","required","htmlFor","onClick","disabled","Snackbar","anchorOrigin","vertical","horizontal","onClose","autoHideDuration","Alert","severity","variant"],"mappings":"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","file":"static/js/18.7781d46f.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/favicon.d8fa18db.png\";","import React, { useEffect, useState } from \"react\";\n// import Sign from \"./Sign\";\nimport account from \"../images/favicon.png\";\n// import profile from \"../image/profile.png\";\nimport { Snackbar } from \"@material-ui/core\";\n// import clear from \"../images/clear.png\";\n// import \"semantic-ui-css/semantic.min.css\";\n// import { NavHashLink } from \"react-router-hash-link\";\n// import useWindowSize from \"../utils/useWindowSize\";\nimport axios from \"axios\";\nimport { Alert } from \"@material-ui/lab\";\nimport NewHeader from \"./NewHeader\";\n\nconst Login = () => {\n  const [email, setEmail] = useState(\"\");\n  const [emailInvalid, setEmailInvalid] = useState(false);\n  const [code, setCode] = useState(\"\");\n  const [codeInvalid, setCodeInvalid] = useState(false);\n  const [success, setSuccess] = useState(false);\n  const [validity, setValidity] = useState(false);\n  const [valid, setValid] = useState(false);\n  const [right, setRight] = useState(false);\n  const [error, setError] = useState({});\n  const [btnloading, setBtnloading] = useState(false);\n  const [loadBtn, setLoadBtn] = useState(false);\n  const [alertState, setAlertState] = useState({\n    open: false,\n    message: \"\",\n    type: \"success\",\n  });\n\n  const otpApi = async () => {\n    const form = {\n      type: \"login\",\n      email: email,\n    };\n    // console.log(form);\n    if (validity) {\n      try {\n        const res = await axios.post(\n          `${process.env.REACT_APP_PUBLIC_URL}send-otp`,\n          form\n        );\n        // .then((res) => {\n        if (res) {\n          //   console.log(\"response msg\", res);\n          setSuccess(res.data.success);\n          //   console.log(success);\n          setBtnloading(false);\n          const { message = \"Otp sent successfully\" } = res.data;\n          setAlertState({ open: true, message, type: \"success\" });\n          // }\n        }\n      } catch (err) {\n        console.log(err);\n        const {\n          message = \"Sorry! We are unable to process your request.\",\n          status_code,\n          errors = {},\n        } = (err.response && err.response.data) || {};\n\n        setSuccess(false);\n        // console.log(success);\n        setBtnloading(false);\n\n        const errArr = Object.keys(errors);\n        if (status_code === 422 && errArr.length) {\n          const error = {};\n          errArr.forEach((key) => (error[key] = errors[key][0]));\n          setError(error);\n        } else {\n          setAlertState({ open: true, message, type: \"error\" });\n        }\n      }\n    }\n  };\n\n  const loginApi = async () => {\n    const form = {\n      email: email,\n      password: code,\n    };\n    if (valid) {\n      // console.log(form);\n      try {\n        const res = await axios.post(\n          `${process.env.REACT_APP_PUBLIC_URL}login`,\n          form\n        );\n        if (res) {\n          // console.log(\"response msg\", res.data);\n          localStorage.setItem(\"accessToken\", res.data.access_token);\n          localStorage.setItem(\"refresh-token\", res.data.refresh_token);\n          //   setLogin(true);\n          setRight(true);\n          // console.log(code, res);\n          setLoadBtn(false);\n          sessionStorage.setItem(\"logged\", true);\n          sessionStorage.setItem(\"mailed\", JSON.stringify(email));\n          //   window.location.reload();\n        }\n      } catch (err) {\n        console.log(err);\n        const {\n          message = \"Sorry! We are unable to process your request.\",\n          status_code,\n          errors = {},\n        } = (err.response && err.response.data) || {};\n\n        setSuccess(false);\n        // console.log(success);\n        setLoadBtn(false);\n\n        const errArr = Object.keys(errors);\n        if (status_code === 422 && errArr.length) {\n          const error = {};\n          errArr.forEach((key) => (error[key] = errors[key][0]));\n          setError(error);\n        } else {\n          setAlertState({ open: true, message, type: \"error\" });\n        }\n      }\n    }\n  };\n\n  useEffect(() => {\n    if (localStorage.getItem(\"accessToken\") !== null) {\n      setRight(true);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (right) {\n      const tokenData = localStorage.getItem(\"accessToken\");\n      const token = JSON.stringify(tokenData);\n      //   console.log(token.slice(1, -1));\n      const headers = {\n        Authorization: `Bearer ${token.slice(1, -1)}`,\n      };\n      //   console.log(headers);\n      // if (right) {\n      axios\n        .get(`${process.env.REACT_APP_PUBLIC_URL}user-profile`, {\n          headers: headers,\n        })\n        .then((res) => {\n          if (res) {\n            const info = res.data.data;\n            // console.log(\"response user profile msg\", info);\n            localStorage.setItem(\"email\", info.email);\n            // localStorage.setItem(\"info\", JSON.stringify(info));\n            localStorage.setItem(\n              \"name\",\n              `${info.first_name} ${info.last_name}`\n            );\n            // localStorage.setItem(\"mobile\", info.mobile);\n            localStorage.setItem(\"role\", info.role);\n            if (info.role === \"admin\") {\n              window.location.href = \"/leads\";\n            }\n            setSuccess(res.data.success);\n            // console.log(success);\n          }\n        })\n        .catch((err) => {\n          console.warn(err);\n        });\n      // }\n    }\n  }, [right]);\n\n  const otpClick = async () => {\n    if (!emailInvalid && email !== \"\") {\n      //   console.log(\"email empty\", email !== \"\");\n      //   console.log(\"email invalid\", !emailInvalid);\n      setValidity(true);\n      setBtnloading(true);\n    }\n    otpApi();\n  };\n\n  useEffect(async () => {\n    otpApi();\n  }, [setValidity, validity]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!(codeInvalid && emailInvalid)) {\n      setValid(true);\n      setLoadBtn(true);\n    }\n    loginApi();\n  };\n  useEffect(async () => {\n    loginApi();\n  }, [setValid, valid]);\n\n  const handleAlertClose = () => {\n    setAlertState({ open: false, message: \"\", type: \"success\" });\n  };\n\n  useEffect(() => {\n    if (success) {\n      const timer = setTimeout(() => {\n        setTimer(false);\n      }, 30000);\n      return () => clearTimeout(timer);\n    }\n  }, [setSuccess, success]);\n\n  const [counter, setCounter] = React.useState(30);\n  const [timer, setTimer] = useState(true);\n  useEffect(() => {\n    if (success) {\n      const timer =\n        counter > 0 && setInterval(() => setCounter(counter - 1), 1000);\n      return () => clearInterval(timer);\n    }\n    // console.log(counter);\n  }, [counter, setSuccess, success]);\n\n  return (\n    <>\n      <NewHeader />\n      <div className=\"login\">\n        <div className=\"container\">\n          <img src={account} alt=\"logo\" />\n          <form action=\"post\" className=\"loginForm\" onSubmit={handleSubmit}>\n            <div className=\"otp\">\n              <div className=\"textInput\">\n                <div className=\"text-input\">\n                  <input\n                    className=\"input\"\n                    value={email}\n                    name=\"email\"\n                    onChange={(e) => {\n                      setEmail(e.target.value);\n                      setEmailInvalid(!e.target.validity.valid);\n                    }}\n                    pattern=\"[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,}$\"\n                    type=\"email\"\n                    required\n                  />\n                  <label htmlFor=\"email\" className=\"input-placeholder\">\n                    Email<span>*</span>\n                  </label>\n                </div>\n                {emailInvalid ? (\n                  <p className=\"error-text\">Please provide a valid email Id</p>\n                ) : null}\n              </div>\n              {success ? (\n                <button\n                  className={`redBtn resend`}\n                  type=\"button\"\n                  onClick={otpClick}\n                  disabled={timer}\n                >\n                  {counter === 0 ? \"Re-send OTP\" : `Re-send OTP(${counter})`}\n                </button>\n              ) : (\n                <button\n                  className={`redBtn`}\n                  type=\"button\"\n                  // onClick={() => setInvalid(emailInvalid)}\n                  onClick={otpClick}\n                  disabled={btnloading}\n                >\n                  {btnloading ? `Sending...` : `Send OTP`}\n                  {/* Send OTP */}\n                </button>\n              )}\n            </div>\n            {success ? (\n              <div className=\"otp\">\n                <div className=\"textInput\">\n                  <div className=\"text-input\">\n                    <input\n                      value={code}\n                      type=\"number\"\n                      className=\"input\"\n                      name=\"code\"\n                      onChange={(e) => {\n                        setCode(e.target.value);\n                        setCodeInvalid(!e.target.validity.valid);\n                      }}\n                      pattern=\"[0-9]{6}\"\n                      required\n                    />\n                    <label htmlFor=\"code\" className=\"input-placeholder\">\n                      Enter OTP<span>*</span>\n                    </label>\n                  </div>\n                  {codeInvalid ? (\n                    <p className=\"error-text\">\n                      The code provided is not valid.\n                    </p>\n                  ) : null}\n                </div>\n                <button type=\"submit\" className=\"redBtn\" disabled={loadBtn}>\n                  Login\n                </button>\n              </div>\n            ) : null}\n          </form>\n        </div>\n        <Snackbar\n          anchorOrigin={{ vertical: \"bottom\", horizontal: \"left\" }}\n          open={alertState.open}\n          onClose={handleAlertClose}\n          autoHideDuration={5000}\n        >\n          <Alert\n            onClose={handleAlertClose}\n            severity={alertState.type}\n            variant=\"filled\"\n          >\n            {alertState.message}\n          </Alert>\n        </Snackbar>\n      </div>\n    </>\n  );\n};\n\nexport default Login;\n"],"sourceRoot":""}